<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [style]="{ width: '700px' }"
  [draggable]="false"
  [resizable]="false"
  [header]="modoEdicion ? 'Editar Viaje' : 'Crear Nuevo Viaje'"
  (onHide)="hideDialog()"
>
  <form [formGroup]="viajeForm" (ngSubmit)="guardar()">
    <div class="form-two-columns">
      <!-- Columna Izquierda -->
      <div class="form-column">
        <p-tag value="InformaciÃ³n del Viaje" icon="pi pi-map" styleClass="tag-primary-light tag-lg" class="mb-1 w-100" />

        <!-- Ruta -->
        <label class="field-label required">
          <i class="pi pi-map-marker icon-bg-primary icon-bg"></i>
          Ruta
        </label>
        <p-select
          id="idRuta"
          formControlName="idRuta"
          [options]="rutas"
          optionLabel="nombre"
          optionValue="idRuta"
          placeholder="Seleccione una ruta"
          [class.ng-invalid]="isFieldInvalid('idRuta')"
          styleClass="w-full custom-select mb-1"
          appendTo="body"
        >
          <ng-template let-ruta pTemplate="item">
            <div>{{ ruta.nombre }}</div>
          </ng-template>
        </p-select>
        <div class="field-helper error" *ngIf="isFieldInvalid('idRuta')">
          <i class="pi pi-exclamation-circle"></i>
          <span *ngIf="f['idRuta'].errors?.['required']">La ruta es requerida</span>
        </div>

        <!-- Bus -->
        <label class="field-label required">
          <i class="pi pi-car icon-bg-primary icon-bg"></i>
          Bus
        </label>
        <p-select
          id="idBus"
          formControlName="idBus"
          [options]="buses"
          optionLabel="placa"
          optionValue="idBus"
          placeholder="Seleccione un bus"
          [class.ng-invalid]="isFieldInvalid('idBus')"
          styleClass="w-full custom-select mb-1"
          appendTo="body"
        >
          <ng-template let-bus pTemplate="item">
            <div>{{ bus.placa }} - {{ bus.modelo || 'Sin modelo' }}</div>
          </ng-template>
        </p-select>
        <div class="field-helper error" *ngIf="isFieldInvalid('idBus')">
          <i class="pi pi-exclamation-circle"></i>
          <span *ngIf="f['idBus'].errors?.['required']">El bus es requerido</span>
        </div>

        <!-- Conductor -->
        <label class="field-label required">
          <i class="pi pi-user icon-bg-primary icon-bg"></i>
          Conductor
        </label>
        <p-select
          id="idConductor"
          formControlName="idConductor"
          [options]="conductores"
          optionLabel="licenciaNumero"
          optionValue="idUsuarioGestion"
          placeholder="Seleccione un conductor"
          [class.ng-invalid]="isFieldInvalid('idConductor')"
          styleClass="w-full custom-select mb-1"
          appendTo="body"
        >
          <ng-template let-conductor pTemplate="item">
            <div>{{ conductor.licenciaNumero }} - {{ conductor.nombreCompleto || conductor.username || 'Sin nombre' }}</div>
          </ng-template>
        </p-select>
        <div class="field-helper error" *ngIf="isFieldInvalid('idConductor')">
          <i class="pi pi-exclamation-circle"></i>
          <span *ngIf="f['idConductor'].errors?.['required']">El conductor es requerido</span>
        </div>
      </div>

      <!-- Columna Derecha -->
      <div class="form-column">
        <p-tag value="Fechas y Estado" icon="pi pi-calendar" styleClass="tag-primary-light tag-lg" class="mb-1 w-100" />

        <!-- Fecha Inicio Programada -->
        <label class="field-label required">
          <i class="pi pi-calendar-plus icon-bg-primary icon-bg"></i>
          Fecha Inicio Programada
        </label>
        <p-calendar
          id="fechaInicioProgramada"
          formControlName="fechaInicioProgramada"
          [showTime]="true"
          [hourFormat]="'24'"
          dateFormat="dd/mm/yy"
          [class.ng-invalid]="isFieldInvalid('fechaInicioProgramada')"
          placeholder="Seleccione fecha y hora de inicio"
          styleClass="w-full mb-1"
        ></p-calendar>
        <div class="field-helper error" *ngIf="isFieldInvalid('fechaInicioProgramada')">
          <i class="pi pi-exclamation-circle"></i>
          <span *ngIf="f['fechaInicioProgramada'].errors?.['required']">La fecha de inicio es requerida</span>
        </div>

        <!-- Fecha Fin Programada -->
        <label class="field-label required">
          <i class="pi pi-calendar-minus icon-bg-primary icon-bg"></i>
          Fecha Fin Programada
        </label>
        <p-calendar
          id="fechaFinProgramada"
          formControlName="fechaFinProgramada"
          [showTime]="true"
          [hourFormat]="'24'"
          dateFormat="dd/mm/yy"
          [class.ng-invalid]="isFieldInvalid('fechaFinProgramada')"
          placeholder="Seleccione fecha y hora de fin"
          styleClass="w-full mb-1"
        ></p-calendar>
        <div class="field-helper error" *ngIf="isFieldInvalid('fechaFinProgramada')">
          <i class="pi pi-exclamation-circle"></i>
          <span *ngIf="f['fechaFinProgramada'].errors?.['required']">La fecha de fin es requerida</span>
        </div>

        <!-- Estado -->
        <label class="field-label required">
          <i class="pi pi-power-off icon-bg-primary icon-bg"></i>
          Estado
        </label>
        <p-select
          id="estado"
          formControlName="estado"
          [options]="estados"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccione un estado"
          [class.ng-invalid]="isFieldInvalid('estado')"
          styleClass="w-full custom-select mb-1"
          appendTo="body"
        ></p-select>
        <div class="field-helper error" *ngIf="isFieldInvalid('estado')">
          <i class="pi pi-exclamation-circle"></i>
          <span *ngIf="f['estado'].errors?.['required']">El estado es requerido</span>
        </div>
      </div>
    </div>
  </form>

  <!-- Footer con botones -->
  <p-toolbar>
    <ng-template #start></ng-template>
    <ng-template #end>
      <div class="d-flex gap-2">
        <p-button label="Cancelar" icon="pi pi-times" (onClick)="hideDialog()" styleClass="btn-danger btn-md" />
        <p-button
          [label]="modoEdicion ? 'Actualizar' : 'Guardar'"
          [icon]="modoEdicion ? 'pi pi-check' : 'pi pi-plus'"
          (onClick)="guardar()"
          [styleClass]="modoEdicion ? 'btn-info btn-md' : 'btn-success btn-md'"
          [disabled]="viajeForm.invalid"
        />
      </div>
    </ng-template>
  </p-toolbar>
</p-dialog>

